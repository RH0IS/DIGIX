<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static 'coinmarketapp/styles.css' %}">
    <title>DIGIX - Coin Market Application</title>
</head>
<body>
    <header>
       <a href="{% url 'demo' %}">
            <div class="logo">
                <img src="{% static 'coinmarketapp/logo.png' %}" alt="CoinMarketApp">
            </div>
       </a>
        <nav>
            <ul>
                <li><a href="/home">Home</a></li>
                <li><a href="#">Cryptocurrencies</a></li>
                <li><a href="/exchange">Exchanges</a></li>
                <li><a href="#">Markets</a></li>
            </ul>
        </nav>
    </header>


     <div class="wrapper">
      <header>Currency Converter</header>
      <form action="#">
        <div class="amount">
          <p>Enter Amount</p>
          <input type="text" value="1">
        </div>
        <div class="drop-list">
          <div class="from">
            <p>From</p>
            <div class="select-box">
              <select>
                <!-- Iterate through currency names and create options -->
                {% for currency_name in name %}
                  <option value="{{ currency_name }}">{{ currency_name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
          <div class="icon"><i class="fas fa-exchange-alt"></i></div>
          <div class="to">
            <p>To</p>
            <div class="select-box">
              <select>
                <!-- Iterate through currency names and create options -->
                {% for currency_name in name %}
                  <option value="{{ currency_name }}">{{ currency_name }}</option>
                {% endfor %}
              </select>
            </div>
          </div>
        </div>
        <div class="exchange-rate">Getting exchange rate...</div>
        <button>Get Exchange Rate</button>
      </form>
    </div>
    <br><br><br>

    <script>
    const dropList = document.querySelectorAll("form select");
    const fromCurrency = document.getElementById("fromCurrency");
    const toCurrency = document.getElementById("toCurrency");
    const getExchangeRateButton = document.getElementById("getExchangeRate");
    const exchangeRateTxt = document.querySelector(".exchange-rate");

    const apiKey = "https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest";
    let url = `https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?CMC_PRO_API_KEY=${apiKey}`;
    const currencyNames = {};


    // Fetch currency names from CoinMarketCap API
    fetch(`https://pro-api.coinmarketcap.com/v1/cryptocurrency/listings/latest?CMC_PRO_API_KEY=${apiKey}`, {
        method: 'GET',
        headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
        }
    })
        .then(response => response.json())
        .then(data => {
            data.data.forEach(currency => {
                currencyNames[currency.symbol] = currency.name;
            });

            // Populate select options with currency names
            for (let i = 0; i < dropList.length; i++) {
                for (let currencyCode in currencyNames) {
                    let selected = i === 0 ? currencyCode === "USD" ? "selected" : "" : currencyCode === "NPR" ? "selected" : "";
                    let optionTag = `<option value="${currencyCode}" ${selected}>${currencyNames[currencyCode]}</option>`;
                    dropList[i].insertAdjacentHTML("beforeend", optionTag);
                }
            }
        })
        .catch(error => {
            console.error('Error fetching currency names: ', error);
        });

    // getButton.addEventListener("click", (e) => {
    //     e.preventDefault();
    //     getExchangeRate();
    // });

    // const exchangeIcon = document.querySelector("form .icon");
    // exchangeIcon.addEventListener("click", () => {
    //     let tempCode = fromCurrency.value;
    //     fromCurrency.value = toCurrency.value;
    //     toCurrency.value = tempCode;
    //     loadFlag(fromCurrency);
    //     loadFlag(toCurrency);
    //     getExchangeRate();
    // });

    fetch(url)
            .then(response => response.json())
            .then(data => {
                const currencyNames = data.data.map(currency => ({
                    name: currency.name,
                    symbol: currency.symbol,
                }));

                // Populate select options with currency names
                currencyNames.forEach(currency => {
                    const optionTag = `<option value="${currency.symbol}">${currency.name}</option>`;
                    fromCurrency.insertAdjacentHTML("beforeend", optionTag);
                    toCurrency.insertAdjacentHTML("beforeend", optionTag);
                });
            })
            .catch(error => {
                console.error('Error fetching currency names: ', error);
            });

    function getExchangeRate() {
            const amount = document.querySelector("form input");
            const fromCurrencyValue = fromCurrency.value;
            const toCurrencyValue = toCurrency.value;

            exchangeRateTxt.innerText = "Getting exchange rate...";

            // Fetch exchange rate from ExchangeRate API
            const exchangeRateUrl = `https://v6.exchangerate-api.com/v6/3ba44afda43062f9ffa4fa5a/latest/${fromCurrencyValue}`;

            console.log('a');
            fetch(exchangeRateUrl)
                .then(response => response.json())
                .then(result => {
                    const exchangeRate = result.conversion_rates[toCurrencyValue];
                    const totalExRate = (amount.value * exchangeRate).toFixed(2);
                    exchangeRateTxt.innerText = `${amount.value} ${fromCurrencyValue} = ${totalExRate} ${toCurrencyValue}`;
                })
                .catch(() => {
                    exchangeRateTxt.innerText = "Something went wrong";
                });
        }
        console.log('b');

        window.addEventListener("load", () => {
            getExchangeRate();
        });

        getExchangeRateButton.addEventListener("click", (e) => {
            e.preventDefault();
            getExchangeRate();
        });
    </script>


x
    <footer>
        <p>&copy; 2023 DIGIX - All Rights Reserved</p>
    </footer>
</body>
</html>
